(()=>{var e={};e.id=353,e.ids=[353],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10651:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});var s=r(41098),a=r(14888);async function n(e){let t=await (0,s.J)();if(!await (0,a.jI)(t.id,e))throw new Response(JSON.stringify({error:"Upgrade required",feature:e}),{status:402});return t}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14888:(e,t,r)=>{"use strict";r.d(t,{Dv:()=>o,jI:()=>i});var s=r(46010);let a={FREE:["resources","nudges","dashboard_analytics"],PLUS:["resources","nudges","contacts","interactions","sms_nudges","rag_search","dashboard_analytics","upcoming_list"],PREMIUM:["resources","nudges","contacts","interactions","sms_nudges","rag_search","dashboard_analytics","upcoming_list","campaigns_admin"]};async function n(e){let t=await s.z.user.findUnique({where:{id:e}});return t?.plan||"FREE"}async function i(e,t){return a[await n(e)].includes(t)}function o(e){return a[e]}},16698:e=>{"use strict";e.exports=require("node:async_hooks")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41098:(e,t,r)=>{"use strict";r.d(t,{J:()=>i,Z:()=>o});var s=r(59054),a=r(54119),n=r(46010);async function i(){let{userId:e}=(0,s.j)();if(!e)throw new Response("Unauthorized",{status:401});let t=await n.z.user.findUnique({where:{id:e}});if(!t){let r=await (0,a.N)(),s=r?.primaryEmailAddress?.emailAddress||"unknown@example.com";t=await n.z.user.create({data:{id:e,email:s}}),await n.z.profile.create({data:{userId:e}})}return{id:t.id,email:t.email}}async function o(){let{userId:e}=(0,s.j)();if(!e)throw new Response("Unauthorized",{status:401});let t=await n.z.user.findUnique({where:{id:e}});if(!t||"ADMIN"!==t.role)throw new Response("Forbidden",{status:403});return{id:t.id,email:t.email}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46010:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});let s=new(require("@prisma/client")).PrismaClient},50487:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>w,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>p,runtime:()=>d});var a=r(96559),n=r(48088),i=r(37719),o=r(46010),u=r(10651),c=r(78297);let d="nodejs";async function l(){let e=await (0,u.M)("contacts"),t=await o.z.contact.findMany({where:{userId:e.id},orderBy:{createdAt:"desc"}});return Response.json(t,{status:200})}async function p(e){let t=await (0,u.M)("contacts");if(!await (0,c.U3)(t.id))return Response.json({error:"Contact limit reached"},{status:402});let r=await e.json(),s=String(r.name||"").trim().slice(0,200);if(!s)return Response.json({error:"Name required"},{status:400});let a=await o.z.contact.create({data:{userId:t.id,name:s,roleLabel:r.roleLabel||null,email:r.email||null,phone:r.phone||null}});return Response.json(a,{status:201})}let w=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/contacts/route",pathname:"/api/contacts",filename:"route",bundlePath:"app/api/contacts/route"},resolvedPagePath:"/Users/Lizzi/Documents/GitHub/ArchImpacts/app/api/contacts/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:f}=w;function g(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{"use strict";e.exports=require("node:crypto")},78297:(e,t,r)=>{"use strict";r.d(t,{U3:()=>i,UK:()=>n,mY:()=>o});var s=r(46010);let a={FREE:{chatsPerMonth:100,contacts:5,smsPerMonth:0},PLUS:{chatsPerMonth:1e3,contacts:100,smsPerMonth:200},PREMIUM:{chatsPerMonth:5e3,contacts:1e3,smsPerMonth:1e3}};async function n(e){let t=new Date;t.setDate(1),t.setHours(0,0,0,0);let r=await s.z.message.count({where:{conversation:{userId:e},role:"user",createdAt:{gte:t}}}),n=await s.z.user.findUnique({where:{id:e}});return r<a[n?.plan||"FREE"].chatsPerMonth}async function i(e){let t=await s.z.contact.count({where:{userId:e}}),r=await s.z.user.findUnique({where:{id:e}});return t<a[r?.plan||"FREE"].contacts}async function o(e){let t=new Date;t.setDate(1),t.setHours(0,0,0,0);let r=await s.z.nudge.count({where:{creatorId:e,channel:"sms",createdAt:{gte:t}}}),n=await s.z.user.findUnique({where:{id:e}});return r<a[n?.plan||"FREE"].smsPerMonth}},78335:()=>{},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,54,119],()=>r(50487));module.exports=s})();