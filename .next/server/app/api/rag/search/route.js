(()=>{var e={};e.id=695,e.ids=[695],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},37830:e=>{"use strict";e.exports=require("node:stream/web")},38977:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>c,runtime:()=>o});var i=r(96559),n=r(48088),u=r(37719),a=r(40704);let o="nodejs";async function c(e){let{searchParams:t}=new URL(e.url),r=t.get("q")||"";if(!r)return Response.json({results:[]},{status:200});let s=await (0,a.b1)(r,6);return Response.json({results:s},{status:200})}let p=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/rag/search/route",pathname:"/api/rag/search",filename:"route",bundlePath:"app/api/rag/search/route"},resolvedPagePath:"/Users/Lizzi/Documents/GitHub/ArchImpacts/app/api/rag/search/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:m}=p;function x(){return(0,u.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},40704:(e,t,r)=>{"use strict";r.d(t,{b1:()=>p,z9:()=>c});var s=r(31630),i=r(46010),n=r(55511);let u=new s.Ay({apiKey:process.env.OPENAI_API_KEY}),a=process.env.EMBEDDING_MODEL||"text-embedding-3-small";async function o(e){return(await u.embeddings.create({model:a,input:e})).data[0].embedding}async function c({title:e,url:t,text:r,meta:s}){let u=(0,n.randomUUID)();await i.z.document.create({data:{id:u,title:e,url:t,meta:s}});let a=function(e,t=1e3){let r=[],s=e.replace(/\r/g,"").split(/\n\n+/),i="";for(let e of s)(i+"\n\n"+e).length>t&&i?(r.push(i.trim()),i=e):i=i?i+"\n\n"+e:e;return i&&r.push(i.trim()),r}(r,1e3);for(let e of a){let t=await o(e),r=Buffer.from(JSON.stringify(t),"utf8");await i.z.chunk.create({data:{documentId:u,content:e,embedding:r}})}return{id:u,chunks:a.length}}async function p(e,t=6){let r=await o(e);return(await i.z.chunk.findMany({include:{document:!0}})).map(e=>{let t=JSON.parse(Buffer.from(e.embedding).toString("utf8"));return{id:e.id,content:e.content,title:e.document.title,url:e.document.url||void 0,similarity:function(e,t){let r=0,s=0,i=0;for(let n=0;n<Math.min(e.length,t.length);n++)r+=e[n]*t[n],s+=e[n]*e[n],i+=t[n]*t[n];return r/(Math.sqrt(s)*Math.sqrt(i)+1e-9)}(r,t)}}).sort((e,t)=>t.similarity-e.similarity).slice(0,t)}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46010:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});let s=new(require("@prisma/client")).PrismaClient},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,676],()=>r(38977));module.exports=s})();